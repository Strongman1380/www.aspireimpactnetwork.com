<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turn-Based Features Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .pass { color: green; }
        .fail { color: red; }
        .info { color: blue; }
        button { margin: 5px; padding: 10px; }
    </style>
</head>
<body>
    <h1>Turn-Based Features Test</h1>
    
    <div class="test-section">
        <h2>Game Mode Testing</h2>
        <button onclick="testCoopMode()">Test Co-op Mode</button>
        <button onclick="testVersusMode()">Test Versus Mode</button>
        <div id="mode-test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Turn Management Testing</h2>
        <button onclick="testTurnAdvancement()">Test Turn Advancement</button>
        <button onclick="testTurnTimer()">Test Turn Timer</button>
        <div id="turn-test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Scoring System Testing</h2>
        <button onclick="testIndividualScoring()">Test Individual Team Scoring</button>
        <button onclick="testStealMechanism()">Test Steal Mechanism</button>
        <div id="scoring-test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>UI State Testing</h2>
        <button onclick="testLockStates()">Test Lock States</button>
        <button onclick="testModalButtons()">Test Modal Buttons</button>
        <div id="ui-test-results"></div>
    </div>
    
    <script src="config.js"></script>
    <script src="game-data.js"></script>
    <script src="game-logic.js"></script>
    <script>
        let testGame;
        
        function initTestGame() {
            // Create a minimal DOM structure for testing
            if (!document.getElementById('teams-container')) {
                document.body.insertAdjacentHTML('beforeend', `
                    <div style="display: none;">
                        <div id="teams-container"></div>
                        <div id="team-scores"></div>
                        <div id="current-turn-indicator"></div>
                        <div id="current-team-name"></div>
                        <div id="current-team-color"></div>
                        <div id="turn-timer-container"></div>
                        <div id="turn-timer-display"></div>
                        <div id="turn-timer-bar"></div>
                        <div id="locks-grid"></div>
                        <div id="progress-lights"></div>
                        <div id="lock-modal" class="hidden">
                            <div class="relative">
                                <div id="lock-content"></div>
                                <div id="coop-buttons"></div>
                                <div id="versus-buttons"></div>
                                <div id="modal-current-team"></div>
                                <div id="modal-turn-timer"></div>
                                <div id="steal-buttons"></div>
                            </div>
                        </div>
                    </div>
                `);
            }
            
            testGame = new ThoughtTrapGame();
            
            // Add test teams
            testGame.gameState.teams = [
                { id: 1, name: 'Team Alpha', color: 'blue', score: 0 },
                { id: 2, name: 'Team Beta', color: 'red', score: 0 },
                { id: 3, name: 'Team Gamma', color: 'green', score: 0 }
            ];
            
            return testGame;
        }
        
        function testCoopMode() {
            const results = document.getElementById('mode-test-results');
            let output = ['<h3>Co-op Mode Test Results:</h3>'];
            
            try {
                const game = initTestGame();
                game.setGameMode('coop');
                
                if (game.gameState.gameMode === 'coop') {
                    output.push('<span class="pass">✓ Co-op mode set correctly</span>');
                } else {
                    output.push('<span class="fail">✗ Co-op mode not set</span>');
                }
                
                // Test that all teams get points in co-op
                game.gameState.currentLocks = [{ id: 1, solved: false }];
                const initialScores = game.gameState.teams.map(t => t.score);
                
                // Simulate solving a lock in co-op mode
                game.gameState.currentLocks[0].solved = true;
                game.gameState.teams.forEach(team => team.score++);
                
                const allTeamsScored = game.gameState.teams.every((team, index) => 
                    team.score === initialScores[index] + 1
                );
                
                if (allTeamsScored) {
                    output.push('<span class="pass">✓ All teams receive points in co-op mode</span>');
                } else {
                    output.push('<span class="fail">✗ Not all teams received points in co-op mode</span>');
                }
                
            } catch (e) {
                output.push('<span class="fail">✗ Co-op mode test error: ' + e.message + '</span>');
            }
            
            results.innerHTML = output.join('<br>');
        }
        
        function testVersusMode() {
            const results = document.getElementById('mode-test-results');
            let output = ['<h3>Versus Mode Test Results:</h3>'];
            
            try {
                const game = initTestGame();
                game.setGameMode('versus');
                
                if (game.gameState.gameMode === 'versus') {
                    output.push('<span class="pass">✓ Versus mode set correctly</span>');
                } else {
                    output.push('<span class="fail">✗ Versus mode not set</span>');
                }
                
                // Test turn-based state initialization
                if (game.gameState.currentTeamIndex === 0) {
                    output.push('<span class="pass">✓ Turn index initialized correctly</span>');
                } else {
                    output.push('<span class="fail">✗ Turn index not initialized</span>');
                }
                
                if (game.gameState.turnTimeLimit > 0) {
                    output.push('<span class="pass">✓ Turn time limit set</span>');
                } else {
                    output.push('<span class="fail">✗ Turn time limit not set</span>');
                }
                
            } catch (e) {
                output.push('<span class="fail">✗ Versus mode test error: ' + e.message + '</span>');
            }
            
            results.innerHTML = output.join('<br>');
        }
        
        function testTurnAdvancement() {
            const results = document.getElementById('turn-test-results');
            let output = ['<h3>Turn Advancement Test Results:</h3>'];
            
            try {
                const game = initTestGame();
                game.setGameMode('versus');
                
                const initialTeamIndex = game.gameState.currentTeamIndex;
                const expectedNextIndex = (initialTeamIndex + 1) % game.gameState.teams.length;
                
                game.nextTurn();
                
                if (game.gameState.currentTeamIndex === expectedNextIndex) {
                    output.push('<span class="pass">✓ Turn advanced correctly</span>');
                } else {
                    output.push('<span class="fail">✗ Turn did not advance correctly</span>');
                }
                
                // Test turn wrapping
                game.gameState.currentTeamIndex = game.gameState.teams.length - 1;
                game.nextTurn();
                
                if (game.gameState.currentTeamIndex === 0) {
                    output.push('<span class="pass">✓ Turn wrapping works correctly</span>');
                } else {
                    output.push('<span class="fail">✗ Turn wrapping failed</span>');
                }
                
            } catch (e) {
                output.push('<span class="fail">✗ Turn advancement test error: ' + e.message + '</span>');
            }
            
            results.innerHTML = output.join('<br>');
        }
        
        function testTurnTimer() {
            const results = document.getElementById('turn-test-results');
            let output = ['<h3>Turn Timer Test Results:</h3>'];
            
            try {
                const game = initTestGame();
                game.setGameMode('versus');
                
                // Test timer initialization
                if (game.gameState.turnTimeRemaining === game.gameState.turnTimeLimit) {
                    output.push('<span class="pass">✓ Turn timer initialized correctly</span>');
                } else {
                    output.push('<span class="fail">✗ Turn timer not initialized correctly</span>');
                }
                
                // Test timer reset on turn advance
                game.gameState.turnTimeRemaining = 30;
                game.nextTurn();
                
                if (game.gameState.turnTimeRemaining === game.gameState.turnTimeLimit) {
                    output.push('<span class="pass">✓ Turn timer resets on turn advance</span>');
                } else {
                    output.push('<span class="fail">✗ Turn timer does not reset on turn advance</span>');
                }
                
            } catch (e) {
                output.push('<span class="fail">✗ Turn timer test error: ' + e.message + '</span>');
            }
            
            results.innerHTML = output.join('<br>');
        }
        
        function testIndividualScoring() {
            const results = document.getElementById('scoring-test-results');
            let output = ['<h3>Individual Scoring Test Results:</h3>'];
            
            try {
                const game = initTestGame();
                game.setGameMode('versus');
                
                const currentTeam = game.gameState.teams[game.gameState.currentTeamIndex];
                const otherTeams = game.gameState.teams.filter(t => t.id !== currentTeam.id);
                
                const initialCurrentScore = currentTeam.score;
                const initialOtherScores = otherTeams.map(t => t.score);
                
                // Simulate current team solving a lock
                currentTeam.score++;
                
                if (currentTeam.score === initialCurrentScore + 1) {
                    output.push('<span class="pass">✓ Current team score increased</span>');
                } else {
                    output.push('<span class="fail">✗ Current team score did not increase</span>');
                }
                
                const otherTeamsUnchanged = otherTeams.every((team, index) => 
                    team.score === initialOtherScores[index]
                );
                
                if (otherTeamsUnchanged) {
                    output.push('<span class="pass">✓ Other teams\' scores unchanged</span>');
                } else {
                    output.push('<span class="fail">✗ Other teams\' scores changed unexpectedly</span>');
                }
                
            } catch (e) {
                output.push('<span class="fail">✗ Individual scoring test error: ' + e.message + '</span>');
            }
            
            results.innerHTML = output.join('<br>');
        }
        
        function testStealMechanism() {
            const results = document.getElementById('scoring-test-results');
            let output = ['<h3>Steal Mechanism Test Results:</h3>'];
            
            try {
                const game = initTestGame();
                game.setGameMode('versus');
                
                const currentTeam = game.gameState.teams[game.gameState.currentTeamIndex];
                const stealingTeam = game.gameState.teams.find(t => t.id !== currentTeam.id);
                
                const initialCurrentScore = currentTeam.score;
                const initialStealingScore = stealingTeam.score;
                
                // Simulate stealing team solving the lock
                stealingTeam.score++;
                
                if (stealingTeam.score === initialStealingScore + 1) {
                    output.push('<span class="pass">✓ Stealing team score increased</span>');
                } else {
                    output.push('<span class="fail">✗ Stealing team score did not increase</span>');
                }
                
                if (currentTeam.score === initialCurrentScore) {
                    output.push('<span class="pass">✓ Current team score unchanged after steal</span>');
                } else {
                    output.push('<span class="fail">✗ Current team score changed after steal</span>');
                }
                
            } catch (e) {
                output.push('<span class="fail">✗ Steal mechanism test error: ' + e.message + '</span>');
            }
            
            results.innerHTML = output.join('<br>');
        }
        
        function testLockStates() {
            const results = document.getElementById('ui-test-results');
            let output = ['<h3>Lock States Test Results:</h3>'];
            
            try {
                const game = initTestGame();
                game.setGameMode('versus');
                
                // Test that currentLockId affects lock availability
                game.gameState.currentLockId = null;
                output.push('<span class="info">Current lock ID: null (all locks available)</span>');
                
                game.gameState.currentLockId = 1;
                output.push('<span class="info">Current lock ID: 1 (only lock 1 available)</span>');
                
                output.push('<span class="pass">✓ Lock state management implemented</span>');
                
            } catch (e) {
                output.push('<span class="fail">✗ Lock states test error: ' + e.message + '</span>');
            }
            
            results.innerHTML = output.join('<br>');
        }
        
        function testModalButtons() {
            const results = document.getElementById('ui-test-results');
            let output = ['<h3>Modal Buttons Test Results:</h3>'];
            
            try {
                const game = initTestGame();
                
                // Test co-op mode buttons
                game.setGameMode('coop');
                output.push('<span class="info">Co-op mode: Should show "Mark as Solved" button</span>');
                
                // Test versus mode buttons
                game.setGameMode('versus');
                output.push('<span class="info">Versus mode: Should show team-specific and steal buttons</span>');
                
                output.push('<span class="pass">✓ Modal button system implemented</span>');
                
            } catch (e) {
                output.push('<span class="fail">✗ Modal buttons test error: ' + e.message + '</span>');
            }
            
            results.innerHTML = output.join('<br>');
        }
        
        // Run basic tests on page load
        window.addEventListener('load', () => {
            console.log('Turn-based features test page loaded');
            console.log('Click the test buttons to verify functionality');
        });
    </script>
</body>
</html>